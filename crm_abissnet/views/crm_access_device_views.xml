<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <!-- ==================== LIST VIEW ==================== -->
  <record id="view_crm_access_device_list" model="ir.ui.view">
    <field name="name">crm.access.device.list</field>
    <field name="model">crm.access.device</field>
    <field name="arch" type="xml">
      <tree string="Access Devices"
            decoration-muted="not active"
            decoration-success="operational_status == 'online'"
            decoration-danger="operational_status == 'faulty'"
            decoration-warning="operational_status == 'maintenance'">
        <field name="name"/>
        <field name="code"/>
        <field name="city_id"/>
        <field name="pop_id"/>
        <field name="device_type"/>
        <field name="manufacturer"/>
        <field name="model_display"/>
        <field name="operational_status"/>
        <field name="port_count"/>
        <field name="ports_used"/>
        <field name="ports_available"/>
        <field name="capacity_percentage" widget="progressbar"/>
        <field name="customer_count"/>
        <field name="active" column_invisible="1"/>
        <field name="model" column_invisible="1"/>
      </tree>
    </field>
  </record>

  <!-- ==================== FORM VIEW ==================== -->
  <record id="view_crm_access_device_form" model="ir.ui.view">
    <field name="name">crm.access.device.form</field>
    <field name="model">crm.access.device</field>
    <field name="arch" type="xml">
      <form string="Access Device">
        <header>
          <field name="operational_status" widget="statusbar" options="{'clickable': '1'}"/>
        </header>

        <sheet>

          <!-- Smart Buttons -->
          <div class="oe_button_box" name="button_box">
            <button type="object" name="action_view_customers" class="oe_stat_button" icon="fa-users">
              <field name="customer_count" widget="statinfo" string="Customers"/>
            </button>

            <button type="object" name="action_view_customers" class="oe_stat_button" icon="fa-plug">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_text">Ports</span>
                <span class="o_stat_value">
                  <field name="ports_used"/> / <field name="port_count"/>
                </span>
              </div>
            </button>
          </div>

          <widget name="web_ribbon" title="Offline" bg_color="text-bg-danger"
                  invisible="operational_status != 'offline'"/>
          <widget name="web_ribbon" title="Faulty" bg_color="text-bg-danger"
                  invisible="operational_status != 'faulty'"/>

          <group>
            <group string="Device Information">
              <field name="name" placeholder="e.g., OLT-TIR-01"/>
              <field name="code" placeholder="Serial number or identifier"/>
              <field name="device_type"/>
              <field name="pop_id" options="{'no_create': True}"/>
              <field name="city_id" readonly="1"/>
              <field name="active"/>
            </group>

            <group string="Technical Specs">
              <field name="manufacturer" required="1"/>
              <field name="manufacturer_other" placeholder="Specify manufacturer"
                     invisible="manufacturer != 'other'" required="manufacturer == 'other'"/>

              <field name="model" required="1"/>
              <field name="model_custom" placeholder="Specify model"
                     invisible="model != 'other'" required="model == 'other'"/>

              <field name="model_display" readonly="1"
                     invisible="not model_display"
                     class="text-muted"/>

              <field name="ip_address" placeholder="192.168.1.1" required="1"/>
              <field name="mac_address" placeholder="AA:BB:CC:DD:EE:FF"/>
              <field name="installation_date"/>
            </group>
          </group>

          <group>
            <group string="Port Capacity">
              <field name="port_count" placeholder="e.g., 48"/>
              <field name="ports_used" readonly="1"/>
              <field name="ports_available" readonly="1"/>
              <field name="capacity_percentage" widget="progressbar" readonly="1"/>
            </group>

            <group string="Integration">
              <field name="nas_device_id"
                     domain="[('company_id', '=', company_id)]"
                     options="{'no_create': True}"
                     help="Link to RADIUS NAS configuration"/>
              <field name="company_id" groups="base.group_multi_company"/>
            </group>
          </group>

          <!-- Notebook -->
          <notebook>

            <!-- ‚úÖ NEW: Command Reference Page -->
            <page string="Command Reference">
              <group col="1">
                <div class="alert alert-info" role="alert">
                  <h4>üìñ OLT Command Reference</h4>
                  <p>Commands for <strong><field name="model_display" nolabel="1" readonly="1" class="d-inline"/></strong></p>
                </div>
              </group>

              <group string="Standard Commands">
                <table class="table table-sm table-bordered">
                  <thead>
                    <tr>
                      <th>Function</th>
                      <th>Command</th>
                      <th>Notes</th>
                    </tr>
                  </thead>
                  <tbody>
                    <!-- ZTE C300 Series -->
                    <tr invisible="model not in ['C220', 'C300', 'C320']">
                      <td><strong>GPON Unconfigured</strong></td>
                      <td><code>show gpon onu uncfg</code></td>
                      <td>C220/C300/C320 standard</td>
                    </tr>

                    <!-- ZTE C600 Series -->
                    <tr invisible="model not in ['C600', 'C650', 'C680']">
                      <td><strong>GPON Unconfigured</strong></td>
                      <td><code>show pon onu uncfg</code></td>
                      <td class="text-success">‚úÖ C600+ unified command</td>
                    </tr>

                    <!-- Huawei -->
                    <tr invisible="manufacturer != 'Huawei'">
                      <td><strong>GPON Autofind</strong></td>
                      <td><code>display ont autofind all</code></td>
                      <td>Huawei MA series</td>
                    </tr>

                    <!-- EPON (all ZTE) -->
                    <tr invisible="manufacturer != 'ZTE'">
                      <td><strong>EPON Unconfigured</strong></td>
                      <td><code>show onu unauthentication</code></td>
                      <td>All ZTE models</td>
                    </tr>

                    <!-- Config Save -->
                    <tr>
                      <td><strong>Save Config</strong></td>
                      <td>
                        <code invisible="manufacturer != 'Huawei'">save</code>
                        <code invisible="manufacturer == 'Huawei'">write</code>
                      </td>
                      <td>Persist configuration</td>
                    </tr>
                  </tbody>
                </table>
              </group>

              <group string="Interface Commands" col="1">
                <div class="text-muted">
                  <strong>Access interface configuration:</strong><br/>
                  ZTE: <code>interface gpon-olt_1/1/1</code> or <code>interface pon-olt_1/1/1</code> (C600+)<br/>
                  Huawei: <code>interface gpon 0/1</code><br/><br/>

                  <strong>Register ONU:</strong><br/>
                  ZTE: <code>onu 1 type ZTE-F612 sn ZTEGC1234567</code><br/>
                  Huawei: <code>ont add 0 sn-auth HWTC12345678 ont-lineprofile-id 5 ont-srvprofile-id 5</code>
                </div>
              </group>
            </page>

            <!-- Default VLANs -->
            <page string="Default VLANs">
              <group string="VLAN Configuration (CSV format supported)">
                <field name="internet_vlan" placeholder="e.g., 1604,1614,1606"/>
                <field name="tv_vlan" placeholder="e.g., 2020"/>
                <field name="voice_vlan" placeholder="e.g., 444"/>
              </group>

              <div class="alert alert-warning" role="alert">
                <strong>‚ÑπÔ∏è VLAN Format:</strong><br/>
                ‚Ä¢ Single value: <code>1604</code><br/>
                ‚Ä¢ Multiple values (CSV): <code>1604,1614,1606</code><br/>
                ‚Ä¢ Valid range: 1-4094
              </div>
            </page>

            <!-- Telnet Access -->
            <page string="Telnet Access">
              <group string="Custom Credentials (Optional)">
                <field name="use_custom_credentials"/>
              </group>

              <group invisible="not use_custom_credentials">
                <group>
                  <field name="telnet_username" placeholder="e.g., admin"
                         required="use_custom_credentials"/>
                  <field name="telnet_password" password="True"
                         required="use_custom_credentials"/>
                </group>
                <group>
                  <div class="alert alert-info" role="alert">
                    <strong>‚ÑπÔ∏è Credential Priority:</strong><br/>
                    1. OLT-specific credentials (if enabled)<br/>
                    2. Company defaults (from FreeRADIUS settings)<br/><br/>
                    If disabled, system uses company-wide credentials from:<br/>
                    <strong>Company ‚Üí FreeRADIUS ‚Üí OLT Telnet Username/Password</strong>
                  </div>
                </group>
              </group>
            </page>

            <!-- Notes -->
            <page string="Notes">
              <field name="notes" nolabel="1" placeholder="Installation notes, configuration details, etc."/>
            </page>

          </notebook>

        </sheet>

        <div class="oe_chatter">
          <field name="message_follower_ids"/>
          <field name="message_ids"/>
        </div>
      </form>
    </field>
  </record>

  <!-- ==================== SEARCH VIEW ==================== -->
  <record id="view_crm_access_device_search" model="ir.ui.view">
    <field name="name">crm.access.device.search</field>
    <field name="model">crm.access.device</field>
    <field name="arch" type="xml">
      <search string="Search Access Devices">
        <field name="name"/>
        <field name="code"/>
        <field name="city_id"/>
        <field name="pop_id"/>
        <field name="manufacturer"/>
        <field name="model"/>
        <field name="model_display"/>
        <field name="ip_address"/>

        <filter string="Active" name="active" domain="[('active', '=', True)]"/>
        <filter string="Archived" name="archived" domain="[('active', '=', False)]"/>

        <separator/>
        <filter string="Online" name="online" domain="[('operational_status', '=', 'online')]"/>
        <filter string="Offline" name="offline" domain="[('operational_status', '=', 'offline')]"/>
        <filter string="Faulty" name="faulty" domain="[('operational_status', '=', 'faulty')]"/>

        <separator/>
        <filter string="OLT" name="olt" domain="[('device_type', '=', 'olt')]"/>
        <filter string="DSLAM" name="dslam" domain="[('device_type', '=', 'dslam')]"/>
        <filter string="Switch" name="switch" domain="[('device_type', '=', 'switch')]"/>

        <separator/>
        <filter string="ZTE" name="zte" domain="[('manufacturer', '=', 'ZTE')]"/>
        <filter string="Huawei" name="huawei" domain="[('manufacturer', '=', 'Huawei')]"/>

        <separator/>
        <filter string="C300 Series" name="c300" domain="[('model', 'in', ['C220', 'C300', 'C320'])]"/>
        <filter string="C600 Series" name="c600" domain="[('model', 'in', ['C600', 'C650', 'C680'])]"/>

        <group expand="0" string="Group By">
          <filter string="City" name="g_city" context="{'group_by': 'city_id'}"/>
          <filter string="POP" name="g_pop" context="{'group_by': 'pop_id'}"/>
          <filter string="Device Type" name="g_type" context="{'group_by': 'device_type'}"/>
          <filter string="Manufacturer" name="g_manu" context="{'group_by': 'manufacturer'}"/>
          <filter string="Model" name="g_model" context="{'group_by': 'model'}"/>
          <filter string="Status" name="g_status" context="{'group_by': 'operational_status'}"/>
        </group>
      </search>
    </field>
  </record>

  <!-- ==================== ACTION ==================== -->
  <record id="action_crm_access_device" model="ir.actions.act_window">
    <field name="name">Access Devices</field>
    <field name="res_model">crm.access.device</field>
    <field name="view_mode">tree,form</field>
    <field name="context">{'search_default_active': 1, 'search_default_olt': 1}</field>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">Add your first access device</p>
      <p>
        Access devices (OLTs, DSLAMs, Switches) are the physical equipment<br/>
        that connect customers to your network at each POP location.<br/><br/>
        <strong>Supported OLT Models:</strong><br/>
        ‚Ä¢ ZTE C220/C300/C320 (uses <code>show gpon onu uncfg</code>)<br/>
        ‚Ä¢ ZTE C600/C650/C680 (uses <code>show pon onu uncfg</code>)<br/>
        ‚Ä¢ Huawei MA5800/MA5600 (uses <code>display ont autofind all</code>)
      </p>
    </field>
  </record>

  <!-- ==================== MENU ITEM ==================== -->
  <menuitem id="menu_crm_access_devices"
            name="Access Devices"
            parent="menu_management"
            action="action_crm_access_device"
            sequence="30"/>
</odoo>