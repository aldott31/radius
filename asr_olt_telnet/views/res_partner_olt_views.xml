<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <!-- Extend res.partner Form to add ONU info in main area -->
  <record id="view_res_partner_form_olt" model="ir.ui.view">
    <field name="name">res.partner.form.olt</field>
    <field name="model">res.partner</field>
    <field name="inherit_id" ref="radius_odoo_integration.view_partner_form_isp_customer"/>
    <field name="arch" type="xml">

      <!-- Load olt_pon_port invisibly so it's available for conditional display -->
      <xpath expr="//field[@name='ont_serial']" position="attributes">
        <attribute name="placeholder">e.g. ZTEG12345678</attribute>
      </xpath>

      <xpath expr="//field[@name='ont_serial']" position="after">
        <field name="olt_pon_port"/>
      </xpath>

      <!-- Add ONU delete button after olt_pon_port field -->
      <xpath expr="//field[@name='olt_pon_port']" position="after">
        <button name="action_delete_onu" type="object"
                string="ğŸ—‘ï¸ Delete ONU"
                class="btn-danger btn-sm"
                invisible="not olt_pon_port"
                confirm="Are you sure you want to delete this ONU from the OLT? This will disconnect the customer!"/>
      </xpath>

      <!-- Add OLT Tools group after ONU/ONT Information -->
      <xpath expr="//page[@string='Network &amp; Infrastructure']//group[.//field[@name='olt_ont_id']]" position="after">
        <group string="OLT Tools" invisible="not access_device_id">
          <button type="action"
                  name="%(asr_olt_telnet.action_open_olt_show_mac_wizard_from_device)d"
                  string="Show MAC on OLT"
                  icon="fa-search"
                  context="{'default_olt_id': access_device_id}"
                  groups="asr_radius_manager.group_isp_provisioning,asr_radius_manager.group_isp_noc,asr_radius_manager.group_isp_manager"/>
          <button type="action"
                  name="%(asr_olt_telnet.action_open_onu_uncfg_wizard)d"
                  string="Unregistered ONUs"
                  icon="fa-list"
                  context="{'default_olt_id': access_device_id}"
                  groups="asr_radius_manager.group_isp_provisioning,asr_radius_manager.group_isp_noc,asr_radius_manager.group_isp_manager"/>
          <button type="action"
                  name="%(asr_olt_telnet.action_olt_command_test_wizard)d"
                  string="Test OLT Commands"
                  icon="fa-terminal"
                  context="{'default_olt_id': access_device_id}"
                  groups="asr_radius_manager.group_isp_provisioning,asr_radius_manager.group_isp_noc,asr_radius_manager.group_isp_manager"/>
        </group>
      </xpath>

    </field>
  </record>
</odoo>