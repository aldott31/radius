<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <!-- LIST (Odoo 17: <list/>) -->
  <record id="view_asr_subscription_list" model="ir.ui.view">
    <field name="name">asr.subscription.list</field>
    <field name="model">asr.subscription</field>
    <field name="arch" type="xml">
      <list string="Subscriptions">
        <field name="name"/>
        <field name="code"/>
        <field name="rate_limit"/>
        <field name="ip_pool_active"/>
        <field name="user_count"/>
        <field name="radius_synced"/>
        <field name="last_sync_date"/>
        <field name="company_id" groups="base.group_multi_company"/>
      </list>
    </field>
  </record>

  <!-- FORM -->
  <record id="view_asr_subscription_form" model="ir.ui.view">
    <field name="name">asr.subscription.form</field>
    <field name="model">asr.subscription</field>
    <field name="arch" type="xml">
      <form string="Subscription Plan">
        <header>
          <button name="action_sync_attributes_to_radius"
                  type="object"
                  string="Sync to RADIUS"
                  class="oe_highlight"
                  groups="ab_radius_connector.group_ab_radius_admin"/>
          <button name="action_remove_from_radius"
                  type="object"
                  string="Remove from RADIUS"
                  class="oe_link"
                  groups="ab_radius_connector.group_ab_radius_admin"
                  invisible="not radius_synced"/>
          <button name="action_view_radius_info"
                  type="object"
                  string="Info"
                  class="oe_link"/>
        </header>

        <sheet>
          <group>
            <group>
              <field name="name" placeholder="p.sh. Paketa 300/30"/>
              <field name="code" placeholder="Auto nga emri nëse bosh"/>
              <field name="company_id" groups="base.group_multi_company"/>
            </group>
            <group>
              <field name="rate_limit" placeholder="UP/DOWN (p.sh. 300/30)"/>
              <field name="ip_pool_active" placeholder="p.sh. PPP-POOL"/>
            </group>
          </group>

          <notebook>

            <!-- Shpjegim i dinamikës (vetëm tekst) -->
            <page string="Dynamic RADIUS Mapping">
              <group col="1">
                <div class="o_form_label">Derived at sync from <b>rate_limit</b> (UP/DOWN Mbps):</div>
                <div class="o_form_label">Cisco-AVPair := ip:sub-policy-in = &lt;UP&gt;M</div>
                <div class="o_form_label">Cisco-AVPair := ip:sub-policy-out = &lt;DOWN&gt;M</div>
                <div class="o_form_label">WISPr-Bandwidth-Max-Up := &lt;UP × 1,000,000&gt;</div>
                <div class="o_form_label">WISPr-Bandwidth-Max-Down := &lt;DOWN × 1,000,000&gt;</div>
                <div class="o_form_label">Framed-Pool := &lt;ip_pool_active ose PPP-POOL&gt;</div>
                <div class="o_form_label">Gjithmonë: Service-Type := Framed-User, Framed-Protocol := PPP</div>
              </group>
            </page>

            <!-- Advanced -->
            <page string="Advanced">
              <group string="Timers">
                <field name="session_timeout" placeholder="sekonda (p.sh. 3600)"/>
                <field name="acct_interim_interval" placeholder="default 300"/>
              </group>
              <group string="Billing (optional)">
                <field name="price"/>
                <field name="product_id"/>
              </group>
            </page>

            <!-- Status -->
            <page string="Sync Status">
              <group>
                <field name="radius_synced" readonly="1"/>
                <field name="last_sync_date" readonly="1"/>
                <field name="last_sync_error" readonly="1" widget="text"/>
              </group>
            </page>

          </notebook>
        </sheet>
      </form>
    </field>
  </record>

  <!-- Smart button -->
  <record id="view_asr_subscription_form_inherit_buttons" model="ir.ui.view">
    <field name="name">asr.subscription.form.buttons.inherit</field>
    <field name="model">asr.subscription</field>
    <field name="inherit_id" ref="view_asr_subscription_form"/>
    <field name="arch" type="xml">
      <xpath expr="//sheet" position="before">
        <div class="oe_button_box" name="button_box">
          <button type="object"
                  name="action_view_radius_users"
                  class="oe_stat_button"
                  icon="fa-users">
            <field name="user_count" widget="statinfo" string="Users"/>
          </button>
        </div>
      </xpath>
    </field>
  </record>

  <!-- Search -->
  <record id="view_asr_subscription_search" model="ir.ui.view">
    <field name="name">asr.subscription.search</field>
    <field name="model">asr.subscription</field>
    <field name="arch" type="xml">
      <search string="Search Subscriptions">
        <field name="name"/>
        <field name="code"/>
        <field name="rate_limit"/>
        <filter string="Synced" name="f_synced" domain="[('radius_synced','=',True)]"/>
        <filter string="Not Synced" name="f_nsynced" domain="[('radius_synced','=',False)]"/>
        <group expand="0" string="Group By">
          <filter string="Company" name="g_company" context="{'group_by':'company_id'}"/>
        </group>
      </search>
    </field>
  </record>

  <!-- Action -->
  <record id="action_asr_subscription" model="ir.actions.act_window">
    <field name="name">Subscriptions</field>
    <field name="res_model">asr.subscription</field>
    <field name="view_mode">list,form</field>
    <field name="help" type="html">
      <p class="o_view_nocontent_smiling_face">
        Create your RADIUS service plans here. Sync writes a dynamic set to <code>radgroupreply</code> based on <b>rate_limit</b>.
      </p>
    </field>
  </record>

  <menuitem id="menu_asr_subscriptions"
            name="Subscriptions"
            parent="menu_asr_radius_root"
            action="action_asr_subscription"
            sequence="20"/>

</odoo>
