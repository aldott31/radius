<?xml version="1.0" encoding="UTF-8"?>
<odoo>

  <!-- List -->
  <record id="view_asr_radius_pppoe_status_list" model="ir.ui.view">
    <field name="name">asr.radius.pppoe_status.list</field>
    <field name="model">asr.radius.pppoe_status</field>
    <field name="arch" type="xml">
      <list string="PPPoE Status" create="0" edit="0" delete="0"
            decoration-success="status == 'ONLINE'"
            decoration-muted="status != 'ONLINE'">
        <field name="status"/>
        <field name="login_on"/>
        <field name="username"/>
        <field name="nas_ip" string="PPPoE Server"/>
        <field name="ip_address"/>
        <field name="attached_plans"/>
        <field name="nas_port"/>
        <field name="circuit_id_mac"/>
        <field name="login_port" string="Login Port"/>
        <field name="virtual_interface" column_invisible="1"/>
      </list>
    </field>
  </record>

  <!-- Form -->
  <record id="view_asr_radius_pppoe_status_form" model="ir.ui.view">
    <field name="name">asr.radius.pppoe_status.form</field>
    <field name="model">asr.radius.pppoe_status</field>
    <field name="arch" type="xml">
      <form string="PPPoE Status" create="0" edit="0" delete="0">
        <sheet>
          <div class="oe_button_box" name="button_box">
            <button name="%(action_asr_radius_session)d" type="action"
                    class="oe_stat_button" icon="fa-history"
                    context="{'search_default_username': username}">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_text">Session</span>
                <span class="o_stat_text">History</span>
              </div>
            </button>
            <button name="action_view_customer" type="object"
                    class="oe_stat_button" icon="fa-user"
                    invisible="not partner_id">
              <div class="o_field_widget o_stat_info">
                <span class="o_stat_text">View</span>
                <span class="o_stat_text">Customer</span>
              </div>
            </button>
          </div>

          <widget name="web_ribbon" title="ONLINE" bg_color="text-bg-success"
                  invisible="status != 'ONLINE'"/>
          <widget name="web_ribbon" title="OFFLINE" bg_color="text-bg-danger"
                  invisible="status == 'ONLINE'"/>

          <div class="oe_title">
            <h1>
              <field name="username" readonly="1"/>
            </h1>
          </div>

          <group string="PPPoE Status">
            <group string="Session Information">
              <field name="status" widget="badge"
                     decoration-success="status == 'ONLINE'"
                     decoration-muted="status != 'ONLINE'"/>
              <field name="login_on" string="Login on"/>
              <field name="username" invisible="1"/>
              <field name="nas_ip" string="PPPoE Server"/>
              <field name="ip_address" string="IP Address"/>
            </group>
            <group string="Network Details">
              <field name="attached_plans" string="Attached Plans"/>
              <field name="nas_port" string="Nas Port"/>
              <field name="login_port" string="Login Port (OLT)"/>
              <field name="virtual_interface"/>
            </group>
          </group>

          <group string="Active Authentication Options">
            <group string="Location">
              <field name="location" nolabel="1"/>
            </group>
          </group>

          <group>
            <group string="MAC ID Authentication">
              <label for="mac_address"/>
              <div class="o_row">
                <field name="mac_address" readonly="1" class="oe_inline"/>
                <span class="badge text-bg-success ml-2" invisible="not mac_auth_enabled">Enabled</span>
                <span class="badge text-bg-secondary ml-2" invisible="mac_auth_enabled">Disabled</span>
              </div>
            </group>
            <group string="Port ID Authentication">
              <label for="login_port"/>
              <div class="o_row">
                <field name="login_port" readonly="1" class="oe_inline" invisible="1"/>
                <span class="oe_inline" style="display: block;">
                  <field name="login_port" readonly="1" nolabel="1"/>
                </span>
                <span class="badge text-bg-success ml-2" invisible="not port_auth_enabled">Enabled</span>
                <span class="badge text-bg-secondary ml-2" invisible="port_auth_enabled">Disabled</span>
              </div>
            </group>
          </group>

          <group>
            <group string="VLAN ID Authentication">
              <label for="vlan_id"/>
              <div class="o_row">
                <field name="vlan_id" readonly="1" class="oe_inline"/>
                <span class="badge text-bg-success ml-2" invisible="not vlan_auth_enabled">Enabled</span>
                <span class="badge text-bg-secondary ml-2" invisible="vlan_auth_enabled">Disabled</span>
              </div>
            </group>
            <group/>
          </group>

          <!-- Hidden fields for computed values -->
          <field name="mac_auth_enabled" invisible="1"/>
          <field name="port_auth_enabled" invisible="1"/>
          <field name="vlan_auth_enabled" invisible="1"/>
          <field name="radius_user_id" invisible="1"/>
          <field name="partner_id" invisible="1"/>

          <notebook>
            <page string="Login Attempts">
              <group>
                <group>
                  <p style="font-style: italic; color: #6c757d;">
                    Login attempts history is available in Session History.
                    Click the "Session History" button above to view all login attempts for this user.
                  </p>
                </group>
              </group>
            </page>
          </notebook>

        </sheet>
      </form>
    </field>
  </record>

  <!-- Search -->
  <record id="view_asr_radius_pppoe_status_search" model="ir.ui.view">
    <field name="name">asr.radius.pppoe_status.search</field>
    <field name="model">asr.radius.pppoe_status</field>
    <field name="arch" type="xml">
      <search string="Search PPPoE Status">
        <field name="username"/>
        <filter name="online" string="Online" domain="[('status','=','ONLINE')]"/>
        <filter name="offline" string="Offline" domain="[('status','!=','ONLINE')]"/>
        <group expand="0" string="Group By">
          <filter name="g_server" string="Server" context="{'group_by': 'nas_ip'}"/>
          <filter name="g_status" string="Status" context="{'group_by': 'status'}"/>
        </group>
      </search>
    </field>
  </record>

  <!-- Action & Menu -->
  <record id="action_asr_radius_pppoe_status" model="ir.actions.act_window">
    <field name="name">PPPoE Status</field>
    <field name="res_model">asr.radius.pppoe_status</field>
    <field name="view_mode">list,form</field>
  </record>

  <menuitem id="menu_asr_radius_pppoe_status"
            name="Live Status"
            parent="menu_isp_monitoring"
            action="action_asr_radius_pppoe_status"
            sequence="10"/>

</odoo>