<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- CONTRACT FORM VIEW -->
    <record id="view_customer_contract_form" model="ir.ui.view">
        <field name="name">customer.contract.form</field>
        <field name="model">customer.contract</field>
        <field name="priority">0</field>
        <field name="arch" type="xml">
            <form string="Customer Contract">
                <header>
                    <button name="action_download_contract" string="Download Contract" type="object"
                            invisible="state == 'draft'" class="btn-success"
                            help="Download contract document with all data filled from template"/>
                    <button name="action_confirm" string="Confirm" type="object"
                            invisible="state != 'draft'" class="btn-primary"/>
                    <button name="action_activate" string="Activate" type="object"
                            invisible="state != 'confirmed'" class="btn-primary"/>
                    <button name="action_expire" string="Mark as Expired" type="object"
                            invisible="state not in ['active']" class="btn-warning"/>
                    <button name="action_cancel" string="Cancel" type="object"
                            invisible="state in ['cancelled', 'expired']" class="btn-secondary"/>
                    <field name="state" widget="statusbar" statusbar_visible="draft,confirmed,active"/>
                </header>

                <sheet>
                    <div class="oe_button_box" name="button_box">
                        <button name="action_view_sale_order" type="object"
                                class="oe_stat_button" icon="fa-shopping-cart"
                                invisible="not sale_order_id">
                            <field name="sale_order_state" widget="label_selection"
                                   options="{'classes': {'draft': 'default', 'sent': 'info', 'sale': 'success', 'done': 'success', 'cancel': 'danger'}}"/>
                            <div class="o_field_widget o_stat_info">
                                <span class="o_stat_text">Sale Order</span>
                            </div>
                        </button>
                    </div>

                    <div class="oe_title">
                        <h1>
                            <field name="name" readonly="1"/>
                        </h1>
                        <h3>
                            <field name="partner_id" options="{'no_create': True}" readonly="1"/>
                        </h3>
                    </div>

                    <group string="Contract Information">
                        <group>
                            <field name="data" readonly="1"/>
                            <field name="tipi_kontrates" readonly="1"/>
                            <field name="afati" readonly="1"/>
                        </group>
                        <group>
                            <field name="pagesa" readonly="1"/>
                            <field name="prepaid_months" invisible="pagesa != 'prepaid'" readonly="1"/>
                        </group>
                    </group>

                    <group string="Customer Details">
                        <group>
                            <field name="emri" readonly="1"/>
                            <field name="mobile_1" readonly="1"/>
                            <field name="email" readonly="1"/>
                            <field name="nr_personal" readonly="1"/>
                            <field name="id_number" readonly="1"/>
                        </group>
                        <group>
                            <field name="adresa_1" readonly="1"/>
                            <field name="qyteti" readonly="1"/>
                            <field name="datelindja" readonly="1"/>
                            <field name="vendlindja" readonly="1"/>
                            <field name="perfaqesuesi_ligjor" readonly="1"/>
                            <field name="nr_personal_perfaqesues" readonly="1"/>
                        </group>
                    </group>

                    <group string="Registration Details">
                        <group>
                            <field name="rregjitruesi" readonly="1"/>
                            <field name="mjeti_identifikimit" readonly="1"/>
                        </group>
                        <group>
                            <field name="nr_serial" readonly="1"/>
                        </group>
                    </group>

                    <group string="Services">
                        <group>
                            <field name="internet" readonly="1"/>
                            <field name="emri_planit_internet" invisible="not internet" readonly="1"/>
                            <field name="televizion" readonly="1"/>
                            <field name="emri_planit_tv" invisible="not televizion" readonly="1"/>
                            <field name="telefoni" readonly="1"/>
                            <field name="emri_planit_telefon" invisible="not telefoni" readonly="1"/>
                        </group>
                        <group>
                            <field name="qyteti_service" readonly="1"/>
                            <field name="emri_planit_service" readonly="1"/>
                            <field name="lloji_lidhjes" readonly="1"/>
                            <field name="teknologjia_tv" readonly="1"/>
                            <field name="ip_statike" readonly="1"/>
                        </group>
                    </group>

                    <group string="Pricing">
                        <group>
                            <field name="cmimi_lloji_lidhjes" widget="monetary" readonly="1"/>
                            <field name="cmimi_teknologjia_tv" widget="monetary" readonly="1"/>
                            <field name="cmimi_planit" widget="monetary" readonly="1"/>
                            <field name="cmimi_ip_statike" widget="monetary" readonly="1"/>
                        </group>
                        <group>
                            <field name="cmimi_cpe_internet" widget="monetary" readonly="1"/>
                            <field name="cmimi_router_wifi" widget="monetary" readonly="1"/>
                            <field name="cmimi_cpe_tv" widget="monetary" readonly="1"/>
                            <field name="cmimi_total" widget="monetary" class="oe_subtotal_footer_separator" readonly="1"/>
                        </group>
                    </group>

                    <group string="Equipment">
                        <group>
                            <field name="cpe_internet_product_ids" widget="many2many_tags" readonly="1"/>
                            <field name="me_keste_internet" readonly="1"/>
                        </group>
                        <group>
                            <field name="router_wifi_product_ids" widget="many2many_tags" readonly="1"/>
                            <field name="me_keste_router" readonly="1"/>
                        </group>
                    </group>

                    <group string="TV Equipment">
                        <group>
                            <field name="cpe_tv_product_ids" widget="many2many_tags" readonly="1"/>
                            <field name="me_keste_tv" readonly="1"/>
                        </group>
                        <group>
                            <field name="total_muaj_paguar" widget="monetary" readonly="1"/>
                        </group>
                    </group>

                    <group string="Notes">
                        <field name="comment" nolabel="1" readonly="1"/>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <!-- CONTRACT LIST VIEW -->
    <record id="view_customer_contract_list" model="ir.ui.view">
        <field name="name">customer.contract.list</field>
        <field name="model">customer.contract</field>
        <field name="arch" type="xml">
            <list string="Contracts">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="data"/>
                <field name="tipi_kontrates"/>
                <field name="emri_planit_service"/>
                <field name="cmimi_total"/>
                <field name="state" widget="badge"
                       decoration-info="state == 'draft'"
                       decoration-primary="state == 'confirmed'"
                       decoration-success="state == 'active'"
                       decoration-warning="state == 'expired'"
                       decoration-muted="state == 'cancelled'"/>
            </list>
        </field>
    </record>

    <!-- CONTRACT SEARCH VIEW -->
    <record id="view_customer_contract_search" model="ir.ui.view">
        <field name="name">customer.contract.search</field>
        <field name="model">customer.contract</field>
        <field name="arch" type="xml">
            <search string="Search Contracts">
                <field name="name"/>
                <field name="partner_id"/>
                <field name="emri_planit_service"/>
                <separator/>
                <filter string="Draft" name="draft" domain="[('state', '=', 'draft')]"/>
                <filter string="Confirmed" name="confirmed" domain="[('state', '=', 'confirmed')]"/>
                <filter string="Active" name="active" domain="[('state', '=', 'active')]"/>
                <filter string="Expired" name="expired" domain="[('state', '=', 'expired')]"/>
                <separator/>
                <group expand="0" string="Group By">
                    <filter string="Customer" name="group_partner" context="{'group_by': 'partner_id'}"/>
                    <filter string="Status" name="group_state" context="{'group_by': 'state'}"/>
                    <filter string="Contract Type" name="group_type" context="{'group_by': 'tipi_kontrates'}"/>
                    <filter string="Date" name="group_date" context="{'group_by': 'data'}"/>
                </group>
            </search>
        </field>
    </record>

    <!-- ACTION: CONTRACTS (No menu item - only accessible via partner smart button) -->
    <record id="action_customer_contracts" model="ir.actions.act_window">
        <field name="name">Contracts</field>
        <field name="res_model">customer.contract</field>
        <field name="view_mode">list,form</field>
        <field name="context">{'search_default_active': 1}</field>
        <field name="help" type="html">
            <p class="o_view_nocontent_smiling_face">
                Create your first customer contract
            </p>
            <p>
                Track all customer contracts with services, pricing, and equipment details.
            </p>
        </field>
    </record>

</odoo>
